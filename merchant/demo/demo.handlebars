<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Flat Payment Form</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">

  <link rel='stylesheet prefetch' href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800'>
  <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css'>

  <link rel="stylesheet" href="css/style.css">


</head>

<body>
  <div class='container'>
    <div class='info'>
      <h1>Hosted Fields Demo</h1>
      <span></span>
    </div>
    <div class="form-container">
      <form class='modal'>
        <header class='header'>
          <h1>Payment of $145.00</h1>
          <div class='card-type'>
            <a class='card active' href='#'>
              <img src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/169963/Amex.png'>
            </a>
            <a class='card' href='#'>
              <img src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/169963/Discover.png'>
            </a>
            <a class='card' href='#'>
              <img src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/169963/Visa.png'>
            </a>
            <a class='card' href='#'>
              <img src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/169963/MC.png'>
            </a>
          </div>
        </header>
        <div class='content'>
          <div class='form'>
            <div class='form-row'>
              <div class='input-group'>
                <label for=''>Card Number</label>
                <div class="input-wrapper" id="card-pan"></div>
              </div>
            </div>
            <div class='form-row'>
              <div class='input-group'>
                <label for=''>Expiry Date</label>
                <div class="input-wrapper" id="expiration-date"></div>
              </div>
              <div class='input-group'>
                <label for=''>CVV</label>
                <div class="input-wrapper" id="card-cvv"></div>
              </div>
              <div class='input-group'>
                <label for=''>PIN</label>
                <div class="input-wrapper" id="card-pin"></div>
              </div>
            </div>
          </div>
        </div>
        <footer class='footer'>
          <button type="submit" class='button'>Complete Payment</button>
        </footer>
      </form>
    </div>
  </div>
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>

  <script src="js/index.js"></script>
  <script src="js/jquery.js"></script>
  <script src="client.js"></script>
  <script src="build.js"></script>

  <script>
  //console.log(window);

        

       jQuery(document).ready(function(){
         
          
          var transactionReference = "1002555990031";
          var merchantCode = "VNA";
          var currencyCode = "566";
          var payableId = "8";
          var amount = 10000;
          var merchantCustomerId = "Adetunji Akinde";
          var channel = "test";

          var submit = document.querySelector('button[type="submit"]');
          
          interswitch.client.newInstanceValue({
            authorizationKey:"387864876819698686283434"
          }, function(err, client){
            /**
            *
            * create payment request
            **/
            if(err) {
              console.log(err);
              //throw some kind of error event
              return;
            }
            console.log("client of callback "+client.request);
            interswitch.hostedFields.newInstance({
              styles: {
                'input': {
                  'font-size': '16px',
                  'font-family': 'roboto, verdana, sans-serif',
                  'font-weight': 'lighter',
                  'color': 'black'
                },
                ':focus': {
                  'color': 'blue'
                },
                '.valid': {
                  'color': 'black'
                },
                '.invalid': {
                  'color': 'red'
                }
              },
              fields: {
                pan: {
                  selector: '#card-pan',
                  placeholder: '1111 1111 1111 1111'
                },
                cvv: {
                  selector: '#card-cvv',
                  placeholder: '111'
                },
                exp: {
                  selector: '#expiration-date',
                  placeholder: 'MM/YY'
                },
                pin:{
                  selector:'#card-pin',
                  placeholder:'PIN'
                }
              },
              payments: { // the values ca be got from button or set in windows super global object
                transactionReference: transactionReference,
                merchantCode: merchantCode,
                merchantCustomerId: merchantCustomerId,
                payableId:payableId,
                currencyCode: currencyCode,
                channel: channel,
                amount: amount,
                dateOfPayment: "2017-03-14T12:24:50"
              }
            },
          function(err, hostedFieldInstance){

            if(err) {
              // something is wrong,

            }
            hostedFieldInstance.on("validityChange" , function(event){
              
              var field = event.fields[event.emittedBy];

                 var formValid = Object.keys(event.fields).every(function (key) {
                    return event.fields[key].isValid;
                  });

                  {{!--if (formValid) {
                    $('.button').show();
                  } else {
                    $('.button').hide();
                  }--}}
              
            });

            hostedFieldInstance.on("notEmpty", function(event){
              
            });
            console.log("hosted instance in place");

              submit.addEventListener('click', function(evt){

                evt.preventDefault();
                evt.stopPropagation();

                hostedFieldInstance.pay(function(err, payload){
                  if(err) {
                    //exception from the server side
                    console.log("error from pay "+err);
                    //update related form field
                    return;
                  }
                  else {
                    var payref = payload.payref;
                    var pan = payload.pan;
                    console.log(JSON.stringify(payload));
                    alert("Payment successful with payment ref of ");
                    window.location.href = "http://www.google.com";
                    return;
                  }
                });
                
              }, false)
          });

     });
            
         
       });
        
    </script>

</body>

</html>
